Файловая система Linux: траблшутинг

Работа с ФС Linux часто сопровождается ошибками. Причины могут быть разными: повреждение дисков, некорректные настройки или системные сбои. Всё это может привести к потере данных или доступа к файлам и дискам, что критично для системного администратора.
Важно уметь быстро диагностировать и устранять такие ошибки — в этом залог стабильности системы.
В этом уроке мы рассмотрим типичные ошибки и научимся диагностировать и устранять их. Благодаря этим навыкам вы сможете справляться с неполадками, связанными с дисками, разделами и файловыми системами.
Проблема № 1. Невозможно монтировать диск
Диск не монтируется, команда mount возвращает ошибку. Что делать?
Решение
Проверьте состояние дисков.
Используйте команду lsblk, чтобы проверить, что диск подключён правильно и у него есть ФС:

 lsblk -f

Эта команда покажет список всех устройств и их файловых систем.
Проверьте логи системы.
Если диск не монтируется, возможно, есть проблемы с ФС. Для просмотра сообщений ядра примените команду dmesg:

 dmesg | grep sdb

Исправьте ошибки файловой системы.
Если ФС повреждена, используйте fsck для её восстановления:

 sudo fsck /dev/sdb1

Попробуйте вручную монтировать диск.
Если предыдущий шаг не помог, попробуйте снова монтировать диск:

 sudo mount /dev/sdb1 /mnt

Проблема № 2. Ошибка при создании архива
Теперь — план действий на случай, когда команда архивации (например, tar) возвращает ошибку или не создаёт архив.
Решение
Проверьте доступное место на диске.
Иногда ошибка возникает из-за нехватки свободного места для создания архива. Проверить это поможет команда:

 df -h

Проверьте права на файлы и каталоги.
Убедитесь, что у вас есть права на чтение файлов и запись в директорию для архивации. Вот так:

 ls -l /path/to/file

Используйте правильные параметры архивации.
Если ошибка связана с неправильным синтаксисом, проверьте параметры команды.
Проблема № 3. Ошибка с RAID — например, md-raid
Как быть, если RAID-массив не работает или повреждён?
Решение
Проверьте состояние RAID.
C помощью команды cat /proc/mdstat оцените текущее состояние RAID-массива:

 cat /proc/mdstat

Диагностируйте неисправности.
Если массив не работает, проверьте, есть ли повреждённые диски или ошибки в конфигурации.
Восстановите RAID-массив.
Если один из дисков вышел из строя, замените его и восстановите RAID командой mdadm:

 sudo mdadm --assemble --scan

Проблема № 4. Отсутствие прав для монтирования диска
Переходим к ситуации, когда при попытке смонтировать диск появляется ошибка Permission denied.
Решение
Проверьте права пользователя.
Для монтирования дисков нужны права администратора. Для выполнения команды используйте sudo:

 sudo mount /dev/sdb1 /mnt

Проверьте права на директорию монтирования.
Убедитесь, что у вас есть права на запись в директорию, куда монтируется диск:

 ls -ld /mnt

Проблема № 5. Раздел повреждён или отсутствует
Симптом в этом случае такой: при запуске системы или попытке поработать с разделом возникает ошибка No such file or directory.
Решение
Проверьте состояние разделов.
Используйте команду fdisk -l, чтобы увидеть список всех разделов и убедиться, что они существуют:

 sudo fdisk -l

Используйте fsck для восстановления файловой системы.
Если раздел повреждён, выполните проверку ФС:

 sudo fsck /dev/sdb1

Если раздел отсутствует, создайте новый.
Раздел не найден? Возможно, его нужно пересоздать с помощью fdisk или parted.
Проблема № 6. Данные недоступны после сбоя файловой системы
Здесь симптомы такие: после сбоя файлы недоступны, появляются ошибки чтения и записи.
Решение
Проверьте состояние ФС.
Запустите fsck для восстановления повреждённой файловой системы:

 sudo fsck /dev/sdb1

Используйте логи для диагностики.
Чтобы найти сообщения об ошибках, выполните команду:

 dmesg | grep sdb

Реинициализируйте RAID.
Если используется RAID, попробуйте восстановить массив с помощью mdadm --assemble или пересобрать его.
fsck, dmesg, lsblk и mdadm помогут эффективно решать проблемы с монтированием дисков, восстановлением данных и конфигурацией RAID-массивов.
Процесс траблшутинга включает не только поиск ошибок, но и использование системных логов, диагностику состояния ФС и RAID, правильную работу с правами доступа. Всё это поможет уверенно работать с файловыми системами и минимизировать время простоя.